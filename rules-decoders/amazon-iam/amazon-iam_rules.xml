<!--
  -  Amazon IAM rules
  -  v1.0 2016/01/05
  -  Created by Wazuh, Inc. <ossec@wazuh.com>.
  -  jose@wazuh.com
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2
-->

<!-- amazon-iam messages -->

<group name="Amazon-iam,">

    <rule id="80600" level="0">
        <decoded_as>AmazonAWS-signin</decoded_as>
        <description>Amazon sign in alerts.</description>
    </rule>

    <rule id="80601" level="2">
        <if_sid>80600</if_sid>
        <action>ConsoleLogin</action>
        <description>Amazon-signin: User Login Success</description>
        <group>amazon,authentication_success</group>
    </rule>

    <rule id="80602" level="5">
        <if_sid>80601</if_sid>
        <match>'ConsoleLogin': u'Failure'</match>
        <description>Amazon-signin: User Login failed</description>
        <group>amazon,authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80603" level="10" frequency="4" timeframe="360">
        <if_matched_sid>80602</if_matched_sid>
        <description>Possible breakin attempt (high number of login attempts).</description>
        <group>amazon,authentication_failures,pci_dss_11.4,pci_dss_10.2.4,pci_dss_10.2.5,</group>
    </rule>


    <rule id="80660" level="0">
        <decoded_as>AmazonAWS-iam</decoded_as>
        <description>Amazon IAM alerts.</description>
    </rule>

    <rule id="80661" level="2">
        <if_sid>80660</if_sid>
        <action>CreateUser</action>
        <description>Amazon-iam: User created</description>
        <group>amazon</group>
    </rule>

    <rule id="80662" level="5">
        <if_sid>80661</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: User creation denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80663" level="5">
        <if_sid>80661</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: User creation error</description>
        <group>amazon</group>
    </rule>

    <rule id="80664" level="2">
        <if_sid>80660</if_sid>
        <action>AddUserToGroup</action>
        <description>Amazon-iam: User added to a group</description>
        <group>amazon</group>
    </rule>

    <rule id="80665" level="5">
        <if_sid>80664</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: User added to a group denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80666" level="5">
        <if_sid>80664</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: User added to a group error</description>
        <group>amazon</group>
    </rule>

    <rule id="80667" level="2">
        <if_sid>80660</if_sid>
        <action>RemoveUserFromGroup</action>
        <description>Amazon-iam: User removed from a group</description>
        <group>amazon</group>
    </rule>

    <rule id="80668" level="5">
        <if_sid>80667</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: User removed from a group denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80669" level="5">
        <if_sid>80667</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: User removed from a group error</description>
        <group>amazon</group>
    </rule>

    <rule id="80670" level="2">
        <if_sid>80660</if_sid>
        <action>UpdateAccessKey</action>
        <description>Amazon-iam: Access key updated</description>
        <group>amazon</group>
    </rule>

    <rule id="80671" level="5">
        <if_sid>80670</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: Access key updated denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80672" level="5">
        <if_sid>80670</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: Access key updated error</description>
        <group>amazon</group>
    </rule>

    <rule id="80673" level="2">
        <if_sid>80660</if_sid>
        <action>AttachGroupPolicy</action>
        <description>Amazon-iam: Group policy attached to a group</description>
        <group>amazon</group>
    </rule>

    <rule id="80674" level="5">
        <if_sid>80673</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: Group policy attached to a group denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80675" level="5">
        <if_sid>80673</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: Group policy attached to a group error</description>
        <group>amazon</group>
    </rule>

    <rule id="80676" level="2">
        <if_sid>80660</if_sid>
        <action>DetachGroupPolicy</action>
        <description>Amazon-iam: Group policy deattached to a group</description>
        <group>amazon</group>
    </rule>

    <rule id="80677" level="5">
        <if_sid>80676</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: Group policy deattached to a group denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80678" level="5">
        <if_sid>80676</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: Group policy deattached to a group error</description>
        <group>amazon</group>
    </rule>

    <rule id="80679" level="2">
        <if_sid>80660</if_sid>
        <action>AttachUserPolicy</action>
        <description>Amazon-iam: User policy attached to a user</description>
        <group>amazon</group>
    </rule>

    <rule id="80680" level="5">
        <if_sid>80679</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: User policy attached to a user denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80681" level="5">
        <if_sid>80679</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: User policy attached to a user error</description>
        <group>amazon</group>
    </rule>

    <rule id="80682" level="2">
        <if_sid>80660</if_sid>
        <action>DetachUserPolicy</action>
        <description>Amazon-iam: User policy deattached to a user</description>
        <group>amazon</group>
    </rule>

    <rule id="80683" level="5">
        <if_sid>80682</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: User policy deattached to a user denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80684" level="5">
        <if_sid>80682</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: User policy deattached to a user error</description>
        <group>amazon</group>
    </rule>

    <rule id="80685" level="2">
        <if_sid>80660</if_sid>
        <action>AttachRolePolicy</action>
        <description>Amazon-iam: Rule policy attached to a user</description>
        <group>amazon</group>
    </rule>

    <rule id="80686" level="5">
        <if_sid>80685</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: Rule policy attached to a user denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80687" level="5">
        <if_sid>80685</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: Rule policy attached to a user error</description>
        <group>amazon</group>
    </rule>

    <rule id="80688" level="2">
        <if_sid>80660</if_sid>
        <action>DetachRolePolicy</action>
        <description>Amazon-iam: Rule policy deattached to a user</description>
        <group>amazon</group>
    </rule>

    <rule id="80689" level="5">
        <if_sid>80688</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: Rule policy deattached to a user denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80690" level="5">
        <if_sid>80688</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: Rule policy deattached to a user error</description>
        <group>amazon</group>
    </rule>

    <rule id="80691" level="2">
        <if_sid>80660</if_sid>
        <action>CreateGroup</action>
        <description>Amazon-iam: Group created</description>
        <group>amazon</group>
    </rule>

    <rule id="80692" level="5">
        <if_sid>80691</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: Group creation denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80693" level="5">
        <if_sid>80691</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: Group creation error</description>
        <group>amazon</group>
    </rule>

    <rule id="80694" level="2">
        <if_sid>80660</if_sid>
        <action>CreateRole</action>
        <description>Amazon-iam: Role created</description>
        <group>amazon</group>
    </rule>

    <rule id="80695" level="5">
        <if_sid>80694</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: Role creation denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80696" level="5">
        <if_sid>80694</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: Role creation error</description>
        <group>amazon</group>
    </rule>

    <rule id="80697" level="2">
        <if_sid>80660</if_sid>
        <action>CreatePolicy</action>
        <description>Amazon-iam: Policy created</description>
        <group>amazon</group>
    </rule>

    <rule id="80698" level="5">
        <if_sid>80697</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: Policy creation denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80699" level="5">
        <if_sid>80697</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: Policy creation error</description>
        <group>amazon</group>
    </rule>

    <rule id="80700" level="2">
        <if_sid>80660</if_sid>
        <action>UpdateAccountPasswordPolicy</action>
        <description>Amazon-iam: Policy password account update</description>
        <group>amazon</group>
    </rule>

    <rule id="80701" level="5">
        <if_sid>80700</if_sid>
        <match>"errorCode":"AccessDenied"</match>
        <description>Amazon-iam: Policy password account update denied</description>
        <group>amazon</group>
    </rule>

    <rule id="80702" level="5">
        <if_sid>80700</if_sid>
        <match>"errorCode":"</match>
        <description>Amazon-iam: Policy password account update error</description>
        <group>amazon</group>
    </rule>

    <rule id="80703" level="2">
        <if_sid>80660</if_sid>
        <action>CreateAccountAlias</action>
        <description>Amazon-iam: Account alias created</description>
        <group>amazon</group>
    </rule> 

    <rule id="80704" level="2">
        <if_sid>80703</if_sid>
        <action>"errorCode":"</action>
        <description>Amazon-iam: Create Account Alias error</description>
        <group>amazon</group>
    </rule>

    <rule id="80705" level="2">
        <if_sid>80660</if_sid>
        <action>DeleteAccountAlias</action>
        <description>Amazon-iam: Account alias deleted</description>
        <group>amazon</group>
    </rule>

    <rule id="80706" level="2">
        <if_sid>80705</if_sid>
        <action>"errorCode":"</action>
        <description>Amazon-iam: Delete account alias error</description>
        <group>amazon</group>
    </rule>


    <rule id="80707" level="2">
        <if_sid>80660</if_sid>
        <action>UpdateInstanceAlias</action>
        <description>Amazon-iam: Account alias updated</description>
        <group>amazon</group>
    </rule>

    <rule id="80708" level="2">
        <if_sid>80707</if_sid>
        <action>"errorCode":"</action>
        <description>Amazon-iam: Update Instance Alias error</description>
        <group>amazon</group>
    </rule>

</group>

<!-- amazon-iam -->
